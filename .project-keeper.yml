sources:
  - type: maven
    path: pom.xml
    modules:
      - integration_tests
      - udf_coverage
      - jar_artifact
  - type: npm
    path: extension/package.json
    artifacts:
      - dist/oracle-vs-extension.js
version:
  fromSource: pom.xml
build:
  runnerOs: ubuntu-24.04
  freeDiskSpace: true
  exasolDbVersions:
    - "2025.1.8"
    - "8.29.13" # Added to test support for TIMESTAMP without nano precision. Remove if/when 7.1 is re-enabled
  # - "7.1.30" # Exasol 7.1.x does not yet support the latest Ubuntu version
  workflows:
    - name: ci-build.yml
      stepCustomizations:
        - action: INSERT_AFTER
          job: matrix-build
          stepId: enable-testcontainer-reuse
          content:
            name: Fix VM Crash in UDFs
            id: fix-vm-crash
            run: sudo sysctl -w kernel.apparmor_restrict_unprivileged_userns=0
        - action: INSERT_AFTER
          job: matrix-build
          stepId: build-pk-verify
          content:
            name: Collect DB Logs on Failure
            id: collect-db-logs
            if: ${{ always() }}
            run: ./collect_db_logs.sh
        - action: INSERT_AFTER
          job: matrix-build
          stepId: collect-db-logs
          content:
            name: Upload DB Logs Artifact
            uses: actions/upload-artifact@v4
            if: ${{ always() }}
            with:
              name: exasol-db-logs-${{ matrix.exasol_db_version }}-${{ github.run_id }}
              path: ${{ steps.collect-db-logs.outputs.db_log_archive }}

excludes:
  # Avoid large diff caused by different formatter settings
  - "E-PK-CORE-18: Outdated content: '.settings/org.eclipse.jdt.ui.prefs'"
  - "E-PK-CORE-18: Outdated content: '.settings/org.eclipse.jdt.core.prefs'"
